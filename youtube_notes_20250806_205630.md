# Building MCP Servers: Best Practices and Avoiding Common Pitfalls
**Created:** October 26, 2023
**Tags:** #MCP #LLM #Server #API #BestPractices #AI

## üìë Table of Contents
1.  [Summary](#-summary)
2.  [Key Concepts](#-key-concepts)
3.  [Detailed Notes](#-detailed-notes)
    *   [Introduction to MCP Servers](#introduction-to-mcp-servers)
    *   [The Pitfalls of Autogenerating MCP Servers](#the-pitfalls-of-autogenerating-mcp-servers)
    *   [Best Practices for Building MCP Servers](#best-practices-for-building-mcp-servers)
4.  [Important Quotes](#-important-quotes)
5.  [Key Takeaways](#-key-takeaways)
6.  [Action Items](#-action-items)
7.  [Quick Reference](#-quick-reference)

## üìù Summary
This presentation discusses the challenges and best practices for building MCP (Machine Communication Protocol) servers, which enable LLMs (Large Language Models) to interact with real-world applications. It argues against simply autogenerating MCP servers from existing APIs and suggests a hybrid approach that prioritizes careful tool selection, tailored descriptions for LLMs, and purpose-built tools that go beyond basic API functionality.

## üéØ Key Concepts

| Concept                      | Description                                                                                                       | Example                                                                 |
|------------------------------|-------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|
| **MCP (Machine Communication Protocol)** | An open protocol standardizing how applications provide context to LLMs and how LLMs can use real-world products. | Enables LLMs to use real-world applications and services.                |
| **MCP Server**               | A server that exposes tools, resources, and prompts to an LLM (the MCP client).                                   | Allows the LLM to interact with an application or service.             |
| **Tools**                    | Actions that an LLM can perform through an MCP server.                                                            | Creating a database, buying an item, preparing a database migration.   |

## üìö Detailed Notes

### Introduction to MCP Servers
- MCP allows LLMs to interface with real-world apps and services.
- Major players like Microsoft (Windows Copilot), Google (Gemini), OpenAI, and Anthropic (Claude) support MCP.
- If you want LLMs to use your app, you need an MCP server.
- MCP servers consist of tools, resources, and prompts. Tools are the most important, representing actions.
- Example: Neon's MCP server allows Cursor (an AI coding assistant) to create applications using Neon's Postgres database.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   MCP Client‚îÇ --> ‚îÇ  MCP Server ‚îÇ --> ‚îÇApplication/‚îÇ
‚îÇ  (e.g. LLM) ‚îÇ     ‚îÇ (Your App)  ‚îÇ     ‚îÇ  Service   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### The Pitfalls of Autogenerating MCP Servers
- Autogenerating MCP servers from Open API schemas is a tempting but flawed approach.
- Services like Stainless, Speakeasy, and Mintlify offer autogeneration, but it's not ideal.

| Problem                         | Description                                                                                                                              | Solution                                                                                                |
|---------------------------------|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------|
| **Extensive APIs**              | LLMs struggle with too many choices. APIs often have many endpoints (e.g., Neon's API has 75-100), overwhelming the LLM. LLMs perform better with reduced context. | Reduce the number of tools exposed to the LLM.                                                            |
| **Poorly Written API Descriptions** | API descriptions are usually written for humans, not LLMs. LLMs need direct instructions and examples.                                  | Tailor tool descriptions specifically for LLMs, potentially using structured formats like XML.           |
| **Low-Level Resource Management** | APIs are designed for developers and automation, focusing on low-level resource creation.                                                 | Focus on high-level tasks and actions that align with achieving specific goals for the LLM.              |
| **Missed Opportunities for Innovation** | Simply exposing an API as an MCP limits the potential for creating more interesting interactions.                                                 | Create purpose-built tools tailored to LLM workflows, even if they don't exist in your current API.      |

-   **Problem 1: Extensive APIs**: LLMs struggle with too many choices. APIs often have many endpoints (e.g., Neon's API has 75-100), overwhelming the LLM. LLMs perform better with reduced context.
-   **Problem 2: Poorly Written API Descriptions**: API descriptions are usually written for humans, not LLMs. LLMs need direct instructions and examples. Tool descriptions should be written specifically for LLMs, potentially using structured formats like XML. Implement tests ("Evals") to ensure that LLMs are calling the right tools for the right jobs.
-   **Problem 3: Low-Level Resource Management**: APIs are designed for developers and automation, focusing on low-level resource creation. LLMs need high-level tasks and actions that align with achieving specific goals.
-   **Problem 4: Missed Opportunities for Innovation**: Simply exposing an API as an MCP limits the potential for creating more interesting interactions.
    -   Example: Instead of a generic "Run SQL" tool, Neon provides "Prepare Database Migration" and "Complete Database Migration" tools. This allows LLMs to stage migrations on temporary branches and test them before committing, which is a more robust and helpful workflow.

### Best Practices for Building MCP Servers

| Practice             | Description                                                                                                                                                                          |
|----------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Don't Autogenerate** | Avoid simply autogenerating an MCP server from your Open API schema.                                                                                                                  |
| **Hybrid Approach**  | Autogenerate an MCP server as a starting point, then curate and refine it. Cut down tools, tailor descriptions, identify purpose-built tools, and write "Evals" (tests). |

-   **Don't Autogenerate**: Avoid simply autogenerating an MCP server from your Open API schema.
-   **Hybrid Approach**: Consider a hybrid approach:
    -   Autogenerate an MCP server as a starting point.
    -   Cut down the number of tools to avoid overwhelming the LLM. Remove any non-essential tools.
    -   Evaluate and refine the descriptions for all remaining tools, tailoring them for LLMs.
    -   Identify interesting, purpose-built tools that are suitable for LLMs but not necessarily part of your existing API.
    -   Write "Evals" (tests) to ensure LLMs use your MCP server correctly.

## üí° Important Quotes
> "If you're building an app or a service and you want LLMs to use your app, you need an MCP server."
>
> "The worst thing you can give an LLM is too much choice."

## üîë Key Takeaways
1. Building an effective MCP server requires more than just exposing an existing API.
2. Carefully curate the tools exposed to LLMs, focusing on high-level tasks and providing clear, LLM-friendly descriptions.
3. Consider creating purpose-built tools tailored to LLM workflows, even if they don't exist in your current API.

## üìã Action Items
- [ ] Review existing APIs and identify potential tools for an MCP server.
- [ ] Draft LLM-friendly descriptions for key API endpoints.
- [ ] Research and implement testing strategies ("Evals") for MCP servers.

## üóÇÔ∏è Quick Reference

| Topic             | Description                                                                                                                   |
|-------------------|-------------------------------------------------------------------------------------------------------------------------------|
| **MCP Server Goal** | Enable LLMs to effectively interact with your application by providing curated tools and resources.                          |
| **Key Anti-Pattern**| Directly autogenerating an MCP server from a full API schema.                                                               |
| **Best Approach**   | Start with autogeneration, but prioritize curation, LLM-focused descriptions, and purpose-built tools.                    |
| **Critical Step**   | Implement testing ("Evals") to ensure the LLM is using the MCP server correctly.                                           |
